@model EcommerceStore.Models.Product

@{
    ViewData["Title"] = "Product Details";
}

<h2>Product Details</h2>

<div class="card mt-3">
    <div class="card-body">
        <h4>@Model.Name</h4>
        <p><strong>Description:</strong> @Model.Description</p>
        <p><strong>Price:</strong> $@Model.Price</p>
        <p><strong>Stock:</strong> @Model.Stock</p>
        <p><strong>Category:</strong> @Model.Category?.Name</p>
        <p>
            <strong>Image:</strong><br />
            @if (!string.IsNullOrEmpty(Model.ImageUrl))
            {
                <img src="@Model.ImageUrl" alt="@Model.Name" class="img-fluid" style="max-width:300px;" />
            }
            else
            {
                <span>No image available</span>
            }
        </p>
    </div>
</div>

<div class="mt-3">
    <a asp-action="Edit" asp-route-id="@Model.Id" class="btn btn-warning">Edit</a>
    <a asp-action="Index" class="btn btn-secondary">Back to List</a>
</div>


<hr />
<h4>Customer Reviews</h4>

@if (Model.Reviews != null && Model.Reviews.Any())
{
    <p>
        <strong>Average Rating:</strong>
        ⭐ @Model.Reviews.Average(r => r.Rating).ToString("0.0")
        ( @Model.Reviews.Count() reviews )
    </p>
    <ul class="list-group mb-3">
        @foreach (var review in Model.Reviews.OrderByDescending(r => r.CreatedAt))
        {
            <li class="list-group-item">
                <strong>@review.User.FullName</strong>
                <span class="text-warning">⭐ @review.Rating</span>
                <br />
                <small class="text-muted">@review.CreatedAt.ToLocalTime()</small>
                <p>@review.Comment</p>

                @if (User.IsInRole("Admin") || User.IsInRole("SuperAdmin"))
                {
                    <form asp-controller="Review" asp-action="Delete" method="post" class="d-inline">
                        <input type="hidden" name="id" value="@review.Id" />
                        <button type="submit" class="btn btn-danger btn-sm">Delete</button>
                    </form>
                }
            </li>
        }
    </ul>
}
else
{
    <p>No reviews yet. Be the first to review!</p>
}

@if (User.Identity.IsAuthenticated)
{
    <form asp-controller="Review" asp-action="Add" method="post">
        <input type="hidden" name="productId" value="@Model.Id" />
        <div class="mb-2">
            <label>Rating (1-5)</label>
            <select name="rating" class="form-select" required>
                <option value="5">⭐ 5</option>
                <option value="4">⭐ 4</option>
                <option value="3">⭐ 3</option>
                <option value="2">⭐ 2</option>
                <option value="1">⭐ 1</option>
            </select>
        </div>
        <div class="mb-2">
            <label>Comment</label>
            <textarea name="comment" class="form-control" rows="3" required></textarea>
        </div>
        <button type="submit" class="btn btn-primary">Submit Review</button>
    </form>
}
else
{
    <p><a asp-controller="Account" asp-action="Login">Login</a> to leave a review.</p>
}
